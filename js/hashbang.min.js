'use strict';((f)=>{const k=f.document,m=f.location;Object.defineProperty(Object.prototype,"define",{value:function(a,b,c){const d="configurable enumerable value writable get set".split(" ");if(null===b||Object.keys(b).every((a)=>!d.includes(a)))b={value:b,writable:c||!1,enumerable:!a.startsWith("_")};Object.defineProperty(this,a,b)}});var e={$:{value:function(a){return this.querySelector(a)}},$$:{value:function(a){return[...this.querySelectorAll(a)]}},addAttribute:{value:function(a){this.setAttribute(a,
"")}},clearChildren:{value:function(){let a;for(;null!==(a=this.firstChild);)this.removeChild(a)}},findParentElement:{value:function(a){let b=this;for(;null!==b&&b!==k.documentElement;){if(b===a)return!0;b=b.parentElement}return!1}}};Object.defineProperties(Element.prototype,e);Object.defineProperties(Document.prototype,e);Object.defineProperties(DocumentFragment.prototype,e);Object.defineProperties(Array.prototype,{clear:{value:function(){for(;this.length;)this.shift()}},select:{value:function(a){return this.reduce((b,
c)=>b.concat(a(c)),[])}}});void 0===Math.clamp&&Math.define("clamp",(a,b,c)=>Math.min(Math.max(+a,+b),+c));e={};e.define("uuid",()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){let b=16*Math.random()|0;"y"===a&&(b=b&3|8);return b.toString(16)}));class n{constructor(a,b){this.define("type",a);this.define("callback",b)}}class g{constructor(){this.define("_events",[])}dispatch(a,...b){this._events.forEach((c)=>{c.type===a&&c.callback(...b)})}on(a,b){this._events.push(new n(a,b))}}
class p{constructor(a,b,c){this.define("name",a);this.define("callback",b);a=a.replace(/\((\/:[a-z]+)\)\?/g,"(?:$1)?");a=a.replace(/:[a-z]+/g,"([a-zA-Z0-9\\-._~!$$&'()*,;=:@+%]+)");this.define("pattern",new RegExp(a));this.define("last",c||!1)}}class l extends Array{constructor(){super();f.addEventListener("hashchange",()=>this.match(),!1)}map(a,b,c){super.push(new p(a,b,c))}match(){const a=`/${m.hash.substr(3)}`;for(let b=0;b<this.length;b++){const c=this[b];let d=a.match(c.pattern);if(null!==d&&
(d.shift(),d=d.map(l.decode),console.info("Router: %s",c.name,d),c.callback(...d),c.last))break}}static encode(a){return a.replace(/ /g,"+")}static decode(a){return f.decodeURIComponent(a.replace(/\+/g," "))}}class h extends g{get ready(){return this._ready}get timeout(){return this._xhr.timeout/1E3}set timeout(a){this._xhr.timeout=1E3*a}constructor(a,b){super();a=a||"json";b=b||"application/json";this.define("_targets",[]);this.define("_accept",b);this.define("_ready",!0,!0);this.define("_xhr",new XMLHttpRequest);
this._xhr.responseType=a;this._xhr.addEventListener("timeout",()=>this._timeout(),!1);this._xhr.addEventListener("load",()=>this._load(),!1);this._xhr.addEventListener("error",()=>this._error(),!1);this._xhr.addEventListener("progress",(a)=>{this.dispatch("progress",a.loaded,a.total)},!1)}_timeout(){this._ready=!0;this._targets.forEach((a)=>a.removeAttribute("loading"));this.dispatch("timeout",this._targets);this.dispatch("ready",this._targets)}_load(){this._ready=!0;this._targets.forEach((a)=>a.removeAttribute("loading"));
400>this._xhr.status?this.dispatch("loaded",this._xhr.response,this._targets):this.dispatch("error",this._xhr.response||{code:this._xhr.status,message:this._xhr.statusText},this._targets);this.dispatch("ready",this._targets)}_error(){this._ready=!0;this._targets.forEach((a)=>a.removeAttribute("loading"));this.dispatch("error",{code:523,message:"Disconnected"},this._targets);this.dispatch("ready",this._targets)}request(a,b,c,d){c=c||null;d=d||null;console.info("Client: %s %s",a,b,c);this._targets.forEach((a)=>
a.removeAttribute("loading"));this._targets.clear();this._xhr.abort();"GET"===a&&null!==c&&(b+=`?${h.query(c)}`);this._xhr.open(a,b,!0);this._xhr.setRequestHeader("Accept",this._accept);"GET"!==a&&null!==c&&(c=JSON.stringify(c),this._xhr.setRequestHeader("Content-Type","application/json"));null!==d&&this._targets.push(...d);this._targets.forEach((a)=>a.addAttribute("loading"));this._xhr.send("GET"!==a?c:null);this._ready=!1}static encode(a){return f.encodeURIComponent(a)}static decode(a){return f.decodeURIComponent(a)}static query(a){return Object.keys(a).map((b)=>
`${b}=${h.encode(a[b])}`).join("&")}}class q{constructor(a){a=a.innerHTML;a=a.replace(/\s{2,}/g,"");a=a.replace(/{{(.*?)}}/g,"',$1,'");a=a.split("{%").join("');");a=a.split("%}").join("a.push('");this.define("_source",new Function(`const a=[];a.push('${a}');return a.join('');`));this.define("_range",k.createRange())}render(a){return this._range.createContextualFragment(this._source.call(a))}}class r extends g{constructor(){super();this.define("_id",null,!0)}start(a){this.stop();this.dispatch("started");
this._id=f.setTimeout(()=>{this.dispatch("ended");this._id=null},1E3*a)}stop(){null!==this._id&&(f.clearTimeout(this._id),this.dispatch("stopped"),this._id=null)}}class t extends g{get open(){return this.element.hasAttribute("open")}set open(a){a?this.element.addAttribute("open"):this.element.removeAttribute("open")}constructor(a){super();this.define("element",a)}show(){this.open=!0}close(){this.open=!1}}e.define("EventDispatcher",g);e.define("Timer",r);e.define("Template",q);e.define("Router",l);
e.define("Client",h);e.define("Showable",t);f.define("hb",e)})(window);